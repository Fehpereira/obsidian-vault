## # D689 O que é um Query Builder

![[Pasted image 20250618190324.png]]
![[Pasted image 20250618190414.png]]

---

## # D690 Instalando o Knex.js

``` bash
npm i knex@3.1.0 sqlite3@5.1.7
```

---

## # D691 Compreendendo o que são migrations

![[Pasted image 20250618201516.png]]
![[Pasted image 20250618201600.png]]
![[Pasted image 20250618201716.png]] 

---

## # D692 Configurando o Knex.js

``` ts
//knexfile.ts

export default {

  client: 'sqlite3',
  connection: {
    filename: './src/database/database.db',

  },
  useNullAsDefault: true,
  migrations: {
    extensions: 'ts',
    directory: './src/database/migrations',
  },
};
```

---

## # D693 Script de execução

```bash
npx knex migrate:make create-courses
```

``` json
//package.json
"knex": "node --import tsx ./node_modules/.bin/knex"
```

``` bash
npm run knex -- migrate:make create-courses
```

---

## # D694 Criando tabela

``` ts
//migration
	import type { Knex } from 'knex';

  

export async function up(knex: Knex): Promise<void> {

  await knex.schema.createTable('courses', (table) => {

    table.increments('id').primary(),

      table.text('name').notNullable(),

      table.timestamp('created_at').defaultTo(knex.fn.now());

  });

}

  

export async function down(knex: Knex): Promise<void> {

  await knex.schema.dropTable('courses');

}
```

``` bash
npm run knex -- migrate:latest
```

---

## # D695 Abrindo banco de dados

Beekeeper

---

## # D696 Criando migration para alterar tabela

``` bash
npm run knex -- migrate:make add-updated-courses
```

``` ts
//migration add-updated-courses
import type { Knex } from 'knex';

export async function up(knex: Knex): Promise<void> {
  await knex.schema.alterTable('courses', (table) => {
  table.timestamp('updated_at').defaultTo(knex.fn.now()).after('created_at');

  });

}

  

export async function down(knex: Knex): Promise<void> {

  await knex.schema.alterTable('courses', (table) => {

    table.dropColumn('updated_at');

  });

}
```

```bash 
npm run knex -- migrate:latest
```

---

## # D697 Revertendo migration

```bash
npm run knex -- migrate:list
```
```bash
npm run knex -- migrate:down (migration)
```
```bash
npm run knex -- migrate:rollback
```
```bash
npm run knex -- migrate:rollback --all
```

---

## # D698 Método de Insert

![[Pasted image 20250619190311.png]]
![[Pasted image 20250619190328.png]]

---

## # D699 Insert com Knex Raw

![[Pasted image 20250619190631.png]]

---

## # D700 Select

![[Pasted image 20250619191652.png]]

---

## # D701 Update

![[Pasted image 20250619193056.png]]

---

## # D702 Delete

![[Pasted image 20250619193257.png]]

---

## # D703 Utilizando Seed

``` bash
npm run knex -- seed:make insert-course-modules
```
```bash
npm run knex -- seed:run
```
![[Pasted image 20250619201729.png]]
![[Pasted image 20250619201736.png]]

---

## # D704 Criando Relacionamento

![[Pasted image 20250619203738.png]]

---

## # D705 Cadastrando Módulos

![[Pasted image 20250619205838.png]]
![[Pasted image 20250619210917.png]]

---

## # D706 Select com Join

![[Pasted image 20250619212534.png]]

---
